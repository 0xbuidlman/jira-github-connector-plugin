<html>
  <head>
    <title>GitHub Repositories</title>

    <script type="text/javascript">

        function confirmation(delete_url) {
            var answer = confirm("Are you sure you want to remove this repository?")
            if (answer){
                window.location = delete_url;
            }
        }

        // private repositories require oauth permission
        function checkRepoVisiblity(){

            var repoVisibility = document.getElementById("repoVisibility").value;

            if(repoVisibility == "private"){
                initOAuth();
            }else{
                document.forms["myform"].submit();
            }
        }

    </script>

    <style type="text/css">


        #gh_config_link{
            margin-top: 10px;
        }

        #gh_config_link a{
            background: url('$action.getBaseURL()/download/resources/com.atlassian.jira.plugins.github.GitHub/images/pencil_icon.jpg');
            background-repeat: no-repeat;
            background-position: right center;
            padding-right: 20px;
            font-size: 8pt;
        }

        .gh_config_h4{
            font-weight: normal;
            color: #3676B7;
            background: url('$action.getBaseURL()/download/resources/com.atlassian.jira.plugins.github.GitHub/images/down_gray_arrow.jpg');
            background-repeat: no-repeat;
            background-position: left center;
            padding-left: 18px;
            margin-top: 18px;
        }

        #gh_post_receive_header{
            font-weight: normal;
            font-size: 10pt;
            color: #666;
            margin-top: 18px;
            margin-bottom: 10px;
        }

        #gh_post_receive{
            margin-bottom: 10px;
        }

        .gh_table{
            margin-left: 16px;
            width: 100%
        }

        .gh_table_project_name{
            font-size: 10pt;
            color: #5F6262;
            padding-top: 14px;
        }

        .gh_table th{
            font-weight: normal;
            color: #656565;
            border-bottom: 1px solid #cccccc;
            font-size: 8pt;
        }

        .gh_table td{
            border-bottom: 1px solid #cccccc;
            font-size: 8pt;
        }

        .gh_table_td_pname{
            border-bottom: none !important;
        }

        #gh_add_repositories{
            margin-left: 18px;
            font-size: 8pt;
            color: #656565;
        }

        #gh_example_link{
            font-size: 6pt;
        }

        #gh_submit{
            font-size: 8pt;
        }

        #gh_messages{
            background-color: #DFEFFE;
            margin-left: 18px;
            margin-top: 18px;
            border: 2px solid #bbb;
            padding: 10px;
            padding-left: 36px;
            -moz-border-radius: 6px;
            -webkit-border-radius: 6px;
            -khtml-border-radius: 6px;
            border-radius: 6px;
            background-image: url('$action.getBaseURL()/download/resources/com.atlassian.jira.plugins.github.GitHub/images/blue_info_icon.jpg');
            background-repeat: no-repeat;
            background-position: 10px 10px;
            font-size: 8pt;
        }

        #gh_messages h2{
            font-size: 8pt;
            color: #333;
        }

    </style>




  </head>

  <body>



            <h3>GitHub Global Plugin Settings </h3>

            <div id='gh_config_link'>
                <a href="$action.getBaseURL()/secure/admin/ConfigureGlobalSettings.jspa">Configure OAuth Settings</a>
            </div>

            <h4 class="gh_config_h4">Existing Linked Repositories</h4>

            <table class="gh_table">


                #foreach ($project in $action.getProjects())
                    #if ($action.getProjectRepositories($project.key))

                        <tr>
                            <td colspan="3" class="gh_table_td_pname"><div class="gh_table_project_name">${project.name}</div></td>
                        </tr>

                        <tr>
                            <th>Repository URL</th>
                            <th>Key</th>
                            <th>Operations</th>
                        </tr>

                    #end

                    #foreach ($repository in $action.getProjectRepositories($project.key))
                        <tr>
                            <td><a href="$repository" target="_new">$repository</a></td>
                            <td>$project.key</td>
                            <td width="120px">
                                <a href="$action.getBaseURL()/secure/admin/GitHubConfigureRepositories.jspa?url=$repository&projectKey=$project.key&nextAction=SyncRepository">Force Sync</a> |
                                <a href="#" onclick="confirmation('$action.getBaseURL()/secure/admin/GitHubConfigureRepositories.jspa?nextAction=DeleteRepository&url=$repository&projectKey=$project.key')">Delete</a>
                            </td>
                        </tr>
                    #end
                #end


            </table>


                #if ($action.getMessages() != "")
                    <div id='gh_messages'>
                           $action.getMessages()
                    </div>
                #end

            <h4 class="gh_config_h4">Add additional GitHub repositories</h4>

                <div id='gh_add_repositories'>
                    <p>Add additional GitHub repositories to the projects to link their commits with JIRA Issue IDs.<br/>

                    Please Enter the JIRA Project and GitHub Repository URL (including branch) you would like linked.</p>

                    #if ($action.getValidations() != "")
                        <div class="aui-message error shadowed">
                               <h3>$action.getValidations() </h3>
                        </div>
                    #end

                    #if ($action.getPostCommitURL() != "")
                        <div id="gh_post_receive">

                               <h4 id="gh_post_receive_header">Add the Post-Receive Hook</h4>

                                <p>Please add the URL below to your GitHub Repositories Post-Receive Hooks</p>

                                <p>
                                    <input type="text" class="text" size="100" value="$action.getBaseURL()/$action.getPostCommitURL()">
                                </p>

                                <div>
                                    <a href="http://help.github.com/post-receive-hooks/" target="_new">Post Receive URL Setup Instructions</a>
                                </div>

                        </div>
                    #end

                     <form class="aui" method="post" action="$action.getBaseURL()/secure/admin/GitHubConfigureRepositories.jspa">
                          <input type="hidden" name="nextAction" value="AddRepository">
                          <table width="500px">

                            <tr>
                              <td valign="top">
                                  <select name="projectKey" class="select medium-field">
                                    #foreach ($project in $action.getProjects())
                                      <option value="${project.key}">${project.name}</option>
                                    #end
                                  </select>
                              </td>

                              <td valign="top">
                                  <select name="repoVisibility" id="repoVisibility" class="select short-field">
                                      <option value="public">Public</option>
                                      <option value="private">Private</option>
                                  </select>
                              </td>

                              <td valign="top">
                                 <input type="text"
                                 class="text"
                                 id="url"
                                 name="url"
                                 value="$action.getURL()"
                                 size="60"
                                 /><br/>

                                  <span id='gh_example_link'><strong>Example Repository URL:</strong> https://github.com/atlassianguy/superproject/master</span>

                              </td>

                                <td valign="top">
                                    <input type="submit" value="Add Repository" id="gh_submit"/>
                                </td>
                            </tr>


                          <table>
                     </form>
                </div>
      <br>

  </body>
</html>